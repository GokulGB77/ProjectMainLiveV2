<!DOCTYPE>

<head>
    <meta charset="utf-8">
    <title>CouchCart. | Login</title>
    <meta name="description" content="CouchCart. Ecommerce Website">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <!-- Add site Favicon -->
    <link rel="icon" href="/user/images/favicon/cropped-favicon-32x32.png" sizes="32x32" />
    <link rel="icon" href="/user/images/favicon/cropped-favicon-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="/user/images/favicon/cropped-favicon-180x180.png" />
    <meta name="msapplication-TileImage" content="/user/images/favicon/cropped-favicon-270x270.png" />

    <!-- All CSS is here
	============================================ -->
    <link rel="stylesheet" href="/user/css/vendor/bootstrap.min.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/vendor/pe-icon-7-stroke.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/vendor/themify-icons.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/vendor/font-awesome.min.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/plugins/animate.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/plugins/aos.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/plugins/magnific-popup.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/plugins/swiper.min.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/plugins/jquery-ui.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/plugins/nice-select.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/plugins/select2.min.css" crossorigin="anonymous" />

    <link rel="stylesheet" href="/user/css/plugins/easyzoom.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/plugins/slinky.css" crossorigin="anonymous" />
    <link rel="stylesheet" href="/user/css/style.css" crossorigin="anonymous" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Include toast plugin after jQuery -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>

    <style>
        /* styles.css */
        .separator-line {
            border: 5px solid #f5f3f3;
            /* Grey border */
            margin: 0;
            /* Remove default margin */
        }
    </style>
</head>

<body>
    <div class="main-wrapper main-wrapper-2">
        <header class="header-area header-responsive-padding header-height-1">
            <div class="header-top d-none d-lg-block bg-gray">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-6 col-6">
                            <div class="welcome-text">
                            </div>
                        </div>
                        <div class="col-lg-6 col-6">
                            <div class="language-currency-wrap">
                                <div class="currency-wrap border-style">
                                    <a class="currency-active" href="#"> Rupee (INR) <i class=" ti-angle-down "></i></a>
                                    <div class="currency-dropdown">
                                        <ul>
                                            <li><a href="#">Dollar (US) </a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="language-wrap">
                                    <a class="language-active" href="#"><img src="/user/images/icon-img/flag.png"
                                            alt=""> English <i class=" ti-angle-down "></i></a>
                                    <div class="language-dropdown">
                                        <ul>
                                            <li><a href="#"><img src="/user/images/icon-img/flag.png" alt="">English
                                                </a></li>
                                            <li><a href="#"><img src="/user/images/icon-img/spanish.png"
                                                        alt="">Spanish</a></li>
                                            <li><a href="#"><img src="/user/images/icon-img/arabic.png" alt="">Arabic
                                                </a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <hr class="separator-line">

            <div class="header-bottom sticky-bar">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-3 col-md-6 col-6">
                            <div class="logo">
                                <a href="/"><img src="/user/images/logo/logo.png" alt="logo"></a>
                            </div>
                        </div>
                        <div class="col-lg-6 d-none d-lg-block">
                            <div class="main-menu text-center">
                                <nav>
                                    <ul>
                                        <li><a href="/">HOME</a></li>
                                        <li><a href="shop/:1">SHOP</a></li>
                                        <li><a href="about-us">ABOUT</a></li>
                                        <li><a href="contact-us">CONTACT US</a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-6">
                            <div class="header-action-wrap">
                                <div class="header-action-style header-search-1">
                                    <!-- Search Icon -->
                                    <a class="search-toggle" href="#">
                                        <i class="pe-7s-search s-open"></i>
                                        <i class="pe-7s-close s-close"></i>
                                    </a>
                                    <div class="search-wrap-1">
                                        <form id="searchForm">
                                            <input id="searchInput" placeholder="Search products…" type="text">
                                            <ul id="suggestionList"></ul>
                                            <button class="button-search" type="submit"><i
                                                    class="pe-7s-search"></i></button>
                                        </form>
                                    </div>


                                    <script>
                                        const searchInput = document.getElementById('searchInput');
                                        const suggestionList = document.getElementById('suggestionList');

                                        searchInput.addEventListener('input', async function () {
                                            const query = searchInput.value;
                                            if (query.trim() === '') {
                                                suggestionList.innerHTML = ''; // Clear suggestion list if query is empty
                                                return;
                                            }

                                            try {
                                                const response = await fetch(`/search/suggestions?query=${encodeURIComponent(query)}`);
                                                const suggestions = await response.json();

                                                // Update suggestion list with retrieved suggestions
                                                suggestionList.innerHTML = suggestions.map(suggestion => `<li>${suggestion}</li>`).join('');
                                            } catch (error) {
                                                console.error('Error fetching suggestions:', error);
                                            }
                                        });
                                    </script>

                                    <style>
                                        #searchForm {
                                            position: relative;
                                            display: inline-block;
                                            width: 300px;
                                            /* Adjust width as needed */
                                        }

                                        #searchInput {
                                            width: calc(100% - 40px);
                                            /* Adjust width for search button */
                                            padding: 10px;
                                            border: 1px solid #ccc;
                                            border-radius: 5px;
                                            box-sizing: border-box;
                                            font-size: 16px;
                                        }

                                        .button-search {
                                            position: absolute;
                                            top: 0;
                                            right: 0;
                                            padding: 0 10px;
                                            background-color: #007bff;
                                            border: none;
                                            border-radius: 0 5px 5px 0;
                                            color: #fff;
                                            cursor: pointer;
                                            transition: background-color 0.3s ease;
                                            height: 100%;
                                        }

                                        .button-search i {
                                            vertical-align: middle;
                                        }

                                        #suggestionList {
                                            list-style-type: none;
                                            margin: 0;
                                            padding: 0;
                                            position: absolute;
                                            top: calc(100% + 5px);
                                            /* Position below input */
                                            left: 0;
                                            width: calc(100% - 2px);
                                            /* Adjust the width to match the input box */
                                            background-color: #fff;
                                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                                            border: 1px solid #ccc;
                                            border-top: none;
                                            border-radius: 0 0 5px 5px;
                                            max-height: 200px;
                                            overflow-y: auto;
                                            z-index: 1000;
                                            /* Ensure the suggestion list appears above other elements */
                                        }

                                        #suggestionList li {
                                            padding: 10px;
                                            cursor: pointer;
                                            border-bottom: 1px solid #ccc;
                                        }

                                        #suggestionList li:last-child {
                                            border-bottom: none;
                                        }
                                    </style>

                                    <script>
                                        document.getElementById('searchForm').addEventListener('submit', function (event) {
                                            event.preventDefault(); // Prevent default form submission

                                            const searchInput = document.getElementById('searchInput').value.trim();

                                            // Send a fetch request to your server with the search query
                                            fetch(`/search?query=${encodeURIComponent(searchInput)}`)
                                                .then(response => response.json())
                                                .then(data => {
                                                    // Process the search results and update the DOM
                                                    console.log(data); // Replace with your logic to update the DOM with search results
                                                })
                                                .catch(error => console.error('Error fetching search results:', error));
                                        });
                                    </script>

                                </div>

                              

                                            <div class="header-action-style d-block d-lg-none">
                                                <!-- Mobile Menu Icon -->
                                                <a class="mobile-menu-active-button" href="#"><i
                                                        class="pe-7s-menu"></i></a>
                                            </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!-- mini cart start -->
            <div class="sidebar-cart-active">
                <div class="sidebar-cart-all">
                    <a class="cart-close" href="#"><i class="pe-7s-close"></i></a>
                    <div class="cart-content">
                        <h3>Shopping Cart</h3>
                        <ul>
                            <li>
                                <div class="cart-img">
                                    <a href="#"><img src="/user/images/cart/cart-1.jpg" alt=""></a>
                                </div>
                                <div class="cart-title">
                                    <h4><a href="#">Stylish Swing Chair</a></h4>
                                    <span> 1 × $49.00 </span>
                                </div>
                                <div class="cart-delete">
                                    <a href="#">×</a>
                                </div>
                            </li>
                            <li>
                                <div class="cart-img">
                                    <a href="#"><img src="/user/images/cart/cart-2.jpg" alt=""></a>
                                </div>
                                <div class="cart-title">
                                    <h4><a href="#">Modern Chairs</a></h4>
                                    <span> 1 × $49.00 </span>
                                </div>
                                <div class="cart-delete">
                                    <a href="#">×</a>
                                </div>
                            </li>
                        </ul>
                        <div class="cart-total">
                            <h4>Subtotal: <span>$170.00</span></h4>
                        </div>
                        <div class="cart-btn btn-hover">
                            <a class="theme-color" href="cart">view cart</a>
                        </div>
                        <div class="checkout-btn btn-hover">
                            <a class="theme-color" href="checkout">checkout</a>
                        </div>
                    </div>
                </div>
            </div>
            <hr class="separator-line">
        </header>
       
        
        

  
    <div class="login-register-area pb-100 pt-95">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-12 offset-lg-2">
            <div class="login-register-wrapper">
              <div class="login-register-tab-list nav">
                <h4> Verify OTP </h4>
              </div>
              <div class="tab-content">
                <div id="lg1" class="tab-pane active">
                  <div class="login-form-container">
                    <div class="login-register-form">
                        <form action="/verify-otp" method="post" id="otpform">
                          <div>
                            <h5 style="color: red; text-align: center;" id="otpmessage"></h5>

                          </div>
                          <input type="text" name="otp" id="otp" placeholder="Enter OTP">
    
                            <div class="button-box btn-hover text-center">
                              <button type="submit" >Submit OTP</button>
                            </div>
                            <br>
                            </form>
                            <div class=" btn-hover text-center">
                              <button onclick="startResendTimer(); resendSuccess();" class="btn btn-outline-secondary" href="/resend-otp" type="button" id="resendOTP"><a href="/resend-otp" style="color: white;">Resend OTP</a></button>   
                              <br>
                              <br>
                              <h6 id="resendTimer"></h6> <!-- Timer display -->
                              <br>
                              <br>
                              <h6 style="color: green; text-align: center;" id="resendotperror"></h6>
                           
                          </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      //**********************//
        //Resend OTP - fetch
      //**********************//
      const resendButton = document.getElementById('resendOTP');
      resendButton.addEventListener('click', async function resendOtp(event) {
          event.preventDefault();

          try {
              const response = await fetch('/resend-otp', {
                  method: 'GET',
              });

              if (response.ok) {
                  // Item remove successfully
                  window.location.href = "/verify-otp";
                  document.getElementById('resendotperror').innerText = 'Resend OTP Successful';
                  console.log('Resend OTP Successful');
                  

              } else {
                  // Handle error
                  document.getElementById('resendotperror').innerText = 'Resend OTP Failed';
                  console.error('Resend OTP Failed');
              }
          } catch (error) {
              console.error('Error:', error);
          }
      });


    </script>
    <script>
      //**********************//
        //Submit OTP - fetch
      //**********************//
       const form = document.getElementById('otpform');
            form.addEventListener('submit', async function submitForm(event) {
                event.preventDefault();
    
                const preformData = new FormData(form);
                const formData = new URLSearchParams(preformData);

                try {
                const response = await fetch('/verify-otp', {
                    method: 'POST',
                    body: formData
                });


                if (response.ok) {
                    // Item remove successfully
                    const data = await response.json();
                    const userId = data.userId;
                    window.location.href = "/home?userId=" + userId;
                    console.log('Verified otp');

                } else {
                    // Handle error
                    document.getElementById('otpmessage').innerText = 'Otp is incorrect';
                    console.error('otp incorrect');
                    setTimeout(() => {
                      document.getElementById('otpmessage').innerText = ""
                      console.log('Error message Disappered');
                    }, 5000);

                }
            } catch (error) {
                console.error('Error:', error);
            }
    
            });

    </script>

    <script>
      let canResend = true;
      let resendTimeout;
      document.getElementById('resendOTP').disabled = true;
  
      const updateResendTimer = () => {

          const resendButton = document.getElementById('resendOTP');
          const resendTimer = document.getElementById('resendTimer');
  
          // Get the remaining time
          const remainingTime = Math.max((resendTimeout - Date.now()) / 1000, 0);
  
          if (remainingTime > 0) {
              // Format remaining time as minutes and seconds
              const minutes = Math.floor(remainingTime / 60);
              const seconds = Math.floor(remainingTime % 60);
              resendTimer.textContent = "Resend OTP in " +minutes+ " minutes "  +seconds+ " seconds.";
          } else {
              // Enable the resend button
              resendButton.disabled = false;
              resendTimer.textContent = 'Send New OTP'; // Clear the timer display
          }
      };
  
      // Start the countdown timer
      const startResendTimer = () => {
          resendTimeout = Date.now() + 2 * 60 * 1000; // 10 seconds
          updateResendTimer();
          // Update the timer every second
          setInterval(updateResendTimer, 1000);
      };
  
      startResendTimer();
  
      const resendSuccess = ()=> {
        document.getElementById('resendotperror').innerText = 'Resend OTP Successful';
          setTimeout(() => {
            document.getElementById('resendotperror').innerText = ""
            console.log('Error message Disappered');        
          }, 3000);
      }
      // Attach a submit event listener to the form
      document.getElementById('otp-form').addEventListener('submit', function (event) {
          // Clear the timeout if the form is submitted
          clearTimeout(resendTimeout);
      });
  </script>

  
<%- include('../layouts/footer.ejs') %>